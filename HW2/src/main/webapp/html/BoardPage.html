goit<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="author" content="HUAN CHEN" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <link rel="stylesheet" type="text/css" href="../css/common-style.css" />
    <link rel="stylesheet" type="text/css" href="../css/Boardpage.css" />
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <title>BoardPage</title>
  </head>
  <body>
    <div
      class="layout"
      style="
        background-image: url('https://trello-backgrounds.s3.amazonaws.com/SharedBackground/1280x1920/c27055897797a5e382379e7bcb63bd79/photo-1685665509769-3a907848565f.jpg');
      "
    >
      <div id="board-header"></div>

      <div class="layoutBottom">
        <!-- Left side layout -->
        <div class="frameLeft">
          <!-- Left top -->
          <div class="frameLeftTop"></div>
          <!-- left bottom -->
          <div class="frameLeftBottom">
            <div class="border-title">Your boards</div>
            <div class="boards" id="boards"></div>
          </div>
        </div>

        <!-- right side layout -->
        <div class="frameRight" id="boardContent">
          <div class="lists" id="lists"></div>
          <div class="add-list" data-toggle="modal" data-target="#listModal">
            Add another list
          </div>
        </div>
      </div>
      <div
        class="modal fade"
        id="boardModal"
        tabindex="-1"
        aria-labelledby="boardModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="boardModalLabel">Create board</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form>
                <div class="form-group">
                  <label for="message-text" class="col-form-label"
                    >Board title:</label
                  >
                  <input class="form-control" id="formTitle" />
                </div>
                <div class="form-group">
                  <label for="message-text" class="col-form-label"
                    >Workspace:</label
                  >
                  <select class="form-control" id="formWorkspace"></select>
                </div>
                <div class="form-group">
                  <label for="message-text" class="col-form-label"
                    >Visibility:</label
                  >
                  <select class="form-control" id="formVisibility">
                    <option>Private</option>
                    <option>Workspace</option>
                    <option>Public</option>
                  </select>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-primary"
                data-dismiss="modal"
                onclick="handleAddBoard()"
              >
                Add
              </button>
            </div>
          </div>
        </div>
      </div>
      <div
        class="modal fade"
        id="cardModal"
        tabindex="-1"
        aria-labelledby="cardModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="cardModalLabel">Add card</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form>
                <div class="form-group">
                  <label for="message-text" class="col-form-label"
                    >Card title:</label
                  >
                  <input class="form-control" id="cardTitle" />
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-primary"
                data-dismiss="modal"
                onclick="handleAddCard()"
              >
                Add
              </button>
            </div>
          </div>
        </div>
      </div>
      <div
        class="modal fade"
        id="listModal"
        tabindex="-1"
        aria-labelledby="listModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="listModalLabel">Add list</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form>
                <div class="form-group">
                  <label for="message-text" class="col-form-label"
                    >List title:</label
                  >
                  <input class="form-control" id="listTitle" />
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-primary"
                data-dismiss="modal"
                onclick="handleAddList()"
              >
                Add
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    $("#board-header").load("Reusable-snippets/board-header.html");
    /** 页面board信息渲染存储的对象
     * name: board的名字
     * lists: board的list列表数组
     * lists-title:list的标题
     * lists-cards:list的card列表
     * 我看接口中还要传workspace的id和Visibility两个字段，这两个字段不影响页面的渲染，在新增board的时候需要传入，我就都还没加上
     * 每次新增完board/list/card之后重新调用drawBoards()方法渲染就行，编辑和删除功能没来得及加
     */
    var boards = [
      {
        name: "test",
        lists: [
          { title: "title1", cards: ["card1"] },
          { title: "title2", cards: ["card1", "card2", "card3", "card4"] },
          { title: "title3", cards: ["card1", "card2", "card3"] },
        ],
      },
      {
        name: "test1",
        lists: [
          { title: "title1", cards: ["card1", "card2", "card3", "card4"] },
        ],
      },
    ];

    var currentBoard = boards[0];

    // 点击侧边栏board的方法，切换board
    function handleClickBoard(e) {
      boards.forEach((item) => {
        item.name === e && (currentBoard = item);
      });
      drawBoards();
    }
    // 绘制board列表的方法，可以在每次修改完board参数之后调用该方法重新渲染页面
    function drawBoards() {
      var elementArray = [];
      boards.forEach((item) => {
        elementArray.push(
          `<div class="menu-item ${
            currentBoard.name === item.name ? "menu-item--active" : ""
          }" onclick="handleClickBoard('${item.name}')">
            <div style="width: 80%; text-align: left" >${item.name}</div>
          </div>`
        );
      });
      $("#boards").html(elementArray);
      drawBoard();
    }
    // 绘制单个board的方法
    function drawBoard() {
      if (!currentBoard) {
        document.getElementById("lists").innerHTML = "";
      }
      var elementList = [];
      currentBoard.lists.forEach((list) => {
        elementList.push(`<div class="list">
            <div class="list-title">${list.title}</div>
            <div class="cards">
              ${drawCard(list.cards)}
            </div>
            ${drawAddCard(list)}
          </div>`);
      });
      $("#lists").html(elementList);
    }
    // 绘制card的方法
    function drawCard(cards) {
      var elementCards = [];
      cards.forEach((card) => {
        elementCards.push(`<div class="card">${card}</div>`);
      });
      return elementCards.join("");
    }
    function drawAddCard(list, isAdding = false) {
      return ` <div class="add-card" 
                    onclick="handleOpenCard('${list.title}')"
                    data-toggle="modal"
                    data-target="#cardModal"
                  >Add a card</div>`;
    }
    var currentList = {};
    // 打开新增card弹窗时配置参数
    function handleOpenCard(e) {
      currentBoard.lists.forEach((list) => {
        list.title === e && (currentList = list);
      });
    }
    // 新增card方法
    function handleAddCard() {
      const input = $("#cardTitle");
      if (!input) {
        return;
      }
      // 这里应该调后端新增card接口然后重新绘制页面
      currentList.cards.push(input.val());
      drawBoards();
    }
    // 新增board方法
    function handleAddBoard() {
      const input = $("#formTitle");
      if (!input) {
        return;
      }
      // 对应的所属空间和可见性两个参数，需要传到后端接口里
      const workspace = $("#formWorkspace");
      const visibility = $("#formVisibility");
      // 这里应该调后端新增board接口然后重新绘制页面
      boards.push({
        name: input.val(),
        lists: [],
      });
      drawBoards();
    }
    // 新增list方法
    function handleAddList() {
      const input = $("#listTitle");
      if (!input) {
        return;
      }
      // 这里应该调后端新增list接口然后重新绘制页面
      currentBoard.lists.push({
        title: input.val(),
        cards: [],
      });
      drawBoards();
    }
    // 查询当前workspace下boards
    $.ajax({
      url: "",
      async: false,
      complete: function () {
        drawBoards();
      },
    });
    $("#formWorkspace").append("<option>Workspace</option>");
    $("#cardModal").on("show.bs.modal", function (event) {
      $("#cardTitle").val("");
    });
    $("#boardModal").on("show.bs.modal", function () {
      $("#formTitle").val("");
    });
    $("#listModal").on("show.bs.modal", function () {
      $("#listTitle").val("");
    });
  </script>
</html>
